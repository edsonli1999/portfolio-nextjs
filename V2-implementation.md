# Storyline Mode Implementation Strategy

## Current Project Analysis

Based on the existing NextJS 13 project structure with:
- App Router and Pages Router components
- Tailwind CSS styling
- TypeScript
- Responsive design (different layouts for small and large screens)

## Implementation Strategy (Desktop-Only)

The storyline mode will be implemented as a desktop-only feature, preserving the current mobile experience. This approach focuses resources on creating a highly immersive experience where screen real estate allows for it, while maintaining the streamlined mobile experience.

### 1. Theme Context System

- Create a ThemeContext to manage different viewing modes and device detection:

```typescript
// src/app/context/ThemeContext.tsx
'use client';

import { createContext, useState, useContext, ReactNode, useEffect } from 'react';

// Define the available themes
type Theme = 'standard' | 'detective' | 'terminal';

// Define the context type
interface ThemeContextType {
  theme: Theme;
  setTheme: (theme: Theme) => void;
  isDesktop: boolean;
}

// Create the context with undefined as default
const ThemeContext = createContext<ThemeContextType | undefined>(undefined);

// Provider component that wraps the app
export function ThemeProvider({ children }: { children: ReactNode }) {
  // Initialize with server-safe defaults
  const [theme, setTheme] = useState<Theme>('standard');
  const [isDesktop, setIsDesktop] = useState(false);
  const [mounted, setMounted] = useState(false);
  
  // Effect to handle initialization after component mounts
  useEffect(() => {
    // Set mounted to true to indicate we're now on the client
    setMounted(true);
    
    // Check if device is desktop
    const desktop = window.innerWidth >= 900;
    setIsDesktop(desktop);
    
    // Get saved theme from localStorage
    const savedTheme = localStorage.getItem('theme') as Theme;
    if (savedTheme && desktop) {
      setTheme(savedTheme);
    } else if (!desktop) {
      // Ensure standard theme on mobile
      setTheme('standard');
    }
    
    // Set up resize listener
    const handleResize = () => {
      const isDesktopNow = window.innerWidth >= 900;
      setIsDesktop(isDesktopNow);
      
      // Switch to standard theme if resized to mobile
      if (!isDesktopNow && theme !== 'standard') {
        setTheme('standard');
      }
    };
    
    window.addEventListener('resize', handleResize);
    
    // Cleanup
    return () => window.removeEventListener('resize', handleResize);
  }, []); // Empty dependency array since this should only run once on mount
  
  // Separate effect to update localStorage when theme changes
  useEffect(() => {
    if (mounted) {
      localStorage.setItem('theme', theme);
    }
  }, [theme, mounted]);
  
  // Create the context value
  const contextValue = {
    theme,
    setTheme,
    isDesktop
  };
  
  return (
    <ThemeContext.Provider value={contextValue}>
      {children}
    </ThemeContext.Provider>
  );
}

// Custom hook to use the theme context
export function useTheme() {
  const context = useContext(ThemeContext);
  
  if (context === undefined) {
    throw new Error('useTheme must be used within a ThemeProvider');
  }
  
  return context;
}
```

### 2. Layout Modifications

- Updated RootLayout to incorporate the ThemeProvider:

```typescript
// src/app/layout.tsx
import './globals.css';
import { Inter } from 'next/font/google';
import { GoogleAnalytics } from '@next/third-parties/google'
import { ThemeProvider } from './context/ThemeContext';

const inter = Inter({ subsets: ['latin'] });

export default function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  const googleAnalyticsId = process.env.NEXT_PUBLIC_GOOGLE_ANALYTICS_ID;

  return (
    <html lang="en">
      <head>
        <title>Edson&apos;s Portfolio</title>
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="description" content="Generated by create next app"></meta>
        <link rel="author" href="https://edson-li.vercel.app"></link>
        <meta name="author" content="Edson Li"></meta>
        <meta name="keywords" content="Edson,Portfolio,Resume"></meta>
      </head>
      <body className={inter.className}>
        <ThemeProvider>
          {children}
        </ThemeProvider>
        {googleAnalyticsId && <GoogleAnalytics gaId={googleAnalyticsId} />}
      </body>
    </html>
  );
}
```

- Modify main page component to conditionally render based on theme and screen size:

```typescript
// src/app/page.tsx
'use client'
import { Metadata } from 'next'
import Header from './components/NavBar/Header'
import Hero from './components/Hero/Hero'
import ContactMe from './components/Contact/ContactMe'
import About from './components/About/About'
import WorkExperience from './components/Experience/WorkExperience'
import Projects from './components/Projects/Projects'
import SmallScreenPage from './components/SmallScreenPage'
import ThemeToggle from './components/ThemeToggle'
import { useTheme } from './context/ThemeContext'

export default function Home() {
  // Use the theme context for screen size and theme
  const { isDesktop, theme } = useTheme();
  
  // Small screens always use standard theme and SmallScreenPage
  if (!isDesktop) {
    return <SmallScreenPage />;
  }
  
  // Desktop screens with different themes
  if (theme === 'standard') {
    // Standard theme (current design)
    return (
      <div className="bg-[rgb(36,36,36)] text-white h-screen snap-y snap-mandatory overflow-scroll z-0 scrollbar">
        <Header />
        <ThemeToggle />

        <section id="hero" className='snap-center'>
          <Hero isSmallScreen={false} />
        </section>

        <section id='about' className='snap-end'>
          <About />
        </section>

        <section id='experience' className='snap-center'>
          <WorkExperience isSmallScreen={false} />
        </section>

        <section id='projects' className='snap-start'>
          <Projects isSmallScreen={false} />
        </section>

        <section id="contact" className='snap-center'>
          <ContactMe />
        </section>
      </div>
    );
  } else if (theme === 'detective') {
    // Detective theme - placeholder until we implement the themed components
    return (
      <div className="bg-[#121212] text-[#f0f0f0] h-screen snap-y snap-mandatory overflow-scroll z-0">
        <Header />
        <ThemeToggle />
        
        <div className="flex flex-col items-center justify-center h-screen">
          <h1 className="text-3xl font-bold text-[#ffd700] mb-4">Detective Theme</h1>
          <p className="text-[#a0a0a0] mb-8">Coming soon... This theme is under investigation.</p>
          <p className="text-[#a0a0a0]">Switch back to Standard mode using the toggle in the top-right corner.</p>
        </div>
      </div>
    );
  } else if (theme === 'terminal') {
    // Terminal theme - placeholder until we implement the themed components
    return (
      <div className="bg-[#0a0a0a] text-[#00ff00] h-screen snap-y snap-mandatory overflow-scroll z-0 font-mono">
        <Header />
        <ThemeToggle />
        
        <div className="flex flex-col items-center justify-center h-screen">
          <div className="w-full max-w-3xl p-5">
            <p className="mb-2">SYSTEM BOOT SEQUENCE INITIALIZED...</p>
            <p className="mb-2">LOADING PORTFOLIO DATA....</p>
            <p className="mb-2">THEME MODULE: TERMINAL v1.0</p>
            <p className="mb-2">STATUS: IN DEVELOPMENT</p>
            <p className="mb-4">...</p>
            <p className="mb-2">PORTFOLIO: EDSON LI</p>
            <p className="mb-2">ACCESS: GRANTED</p>
            <p className="mb-4">...</p>
            <p className="mb-2">NOTICE: TERMINAL THEME CURRENTLY IN DEVELOPMENT</p>
            <p className="mb-2">RETURN TO STANDARD MODE USING THE TOGGLE IN THE TOP-RIGHT CORNER</p>
            <div className="h-5 w-16 bg-[#00ff00] mt-4 animate-pulse"></div>
          </div>
        </div>
      </div>
    );
  }
  
  // Fallback to standard theme
  return <SmallScreenPage />;
}
```

### 3. Component-Based Implementation

- Create themed variants of each component for desktop only:

```typescript
// src/app/components/Hero/DetectiveHero.tsx
import React from 'react'
import Image from 'next/image'
import Link from 'next/link'
import { useTypewriter, Cursor } from 'react-simple-typewriter'

function DetectiveHero() {
  const [text, count] = useTypewriter({
    words: ["Case File: Edson Li", "Status: Active Investigation", "Clearance: Level 5"],
    loop: true,
    delaySpeed: 2000,
  })

  return (
    <div className="h-screen flex flex-col space-y-8 items-center justify-center text-center overflow-hidden bg-detective-primary">
      {/* Detective themed background */}
      <div className="absolute top-0 left-0 w-full h-full opacity-20 z-0">
        <Image
          src="/detective/background-texture.png"
          alt=""
          layout="fill"
          objectFit="cover"
        />
      </div>
      
      {/* Profile image with detective styling */}
      <div className="relative z-10 border-4 border-detective-accent p-1 rounded-lg shadow-lg">
        <Image
          className="grayscale"
          src="/detective/profile.jpg"
          alt=""
          width="150"
          height="100"
        />
        <div className="absolute -bottom-3 -right-3 bg-detective-primary px-2 py-1 text-xs font-detective text-detective-accent border border-detective-accent">
          EVIDENCE #1
        </div>
      </div>
      
      <div className="z-20 bg-detective-secondary p-6 border border-detective-accent max-w-md relative">
        <div className="absolute -top-3 left-4 bg-detective-primary px-2 py-1 text-xs font-detective text-detective-accent">
          CONFIDENTIAL
        </div>
        <h2 className="text-sm uppercase text-detective-text-faded pb-2 font-detective tracking-wider">Subject Background: Computer Science Graduate</h2>
        <h2 className="text-sm uppercase text-detective-text-faded pb-4 font-detective tracking-wider">Last Known Location: University of Melbourne</h2>
        <h1 className="text-2xl lg:text-4xl font-bold px-5 font-detective text-detective-accent">
          <span>{text}</span>
          <Cursor cursorColor="#ffd700" />
        </h1>
        
        {/* Navigation styled as case file tabs */}
        <div className="pt-8 flex flex-wrap justify-center gap-2">
          <Link href="#about">
            <button className="detective-button">Dossier</button>
          </Link>
          <Link href="#experience">
            <button className="detective-button">Timeline</button>
          </Link>
          <Link href="#projects">
            <button className="detective-button">Evidence</button>
          </Link>
          <Link href="#contact">
            <button className="detective-button">Report</button>
          </Link>
        </div>
      </div>
    </div>
  )
}

export default DetectiveHero
```

### 4. Theme Availability Indicator for Mobile

- Added a Theme Teaser on mobile that indicates the desktop experience is available:

```typescript
// src/app/components/SmallScreenPage.tsx (partial)
'use client';

import React, { useState, useEffect } from 'react';
import Header from './NavBar/Header';
import Hero from './Hero/Hero';
import ContactMe from './Contact/ContactMe';

const ThemeTeaser = () => {
  const [mounted, setMounted] = useState(false);
  
  // Only render after component mounts on the client
  useEffect(() => {
    setMounted(true);
  }, []);
  
  if (!mounted) return null;
  
  return (
    <div className="fixed bottom-5 left-0 right-0 mx-auto w-max bg-gray-800 text-white text-xs px-4 py-2 rounded-full opacity-80 z-50">
      <p>A more cinematic experience available on desktop! ;)</p>
    </div>
  );
};

const SmallScreenPage: React.FC = () => {
    return (
        <div className="bg-[rgb(36,36,36)] text-white h-screen snap-y snap-mandatory overflow-scroll z-0 scrollbar">
            <Header />

            <section id="hero" className='snap-center'>
                <Hero isSmallScreen={true} />
            </section>

            {/* <section id='about' className='snap-end'>
                <About />
            </section> */}

            {/* Make work experience and projects external pages */}

            <section id="contact" className='snap-center'>
                <ContactMe />
            </section>

            {/* Add desktop theme teaser */}
            <ThemeTeaser />
        </div>
    );
};

export default SmallScreenPage;
```

### 5. CSS Implementation with Tailwind Extension

- Extended Tailwind configuration with theme variables:

```javascript
// tailwind.config.js
/** @type {import('tailwindcss').Config} */
module.exports = {
  content: [
    './src/pages/**/*.{js,ts,jsx,tsx,mdx}',
    './src/components/**/*.{js,ts,jsx,tsx,mdx}',
    './src/app/**/*.{js,ts,jsx,tsx,mdx}',

    // Or if using `src` directory:
    "./src/**/*.{js,ts,jsx,tsx,mdx}",
  ],
  theme: {
    extend: {
      backgroundImage: {
        'gradient-radial': 'radial-gradient(var(--tw-gradient-stops))',
        'gradient-conic':
          'conic-gradient(from 180deg at 50% 50%, var(--tw-gradient-stops))',
      },
      // Theme-specific colors
      colors: {
        // Detective theme colors
        detective: {
          primary: '#121212',
          secondary: '#343434',
          accent: '#ffd700',
          text: '#f0f0f0',
          'text-faded': '#a0a0a0',
        },
        // Terminal theme colors
        terminal: {
          primary: '#0a0a0a',
          secondary: '#1a1a1a',
          accent: '#00ff00',
          text: '#00ff00',
          'text-faded': '#007700',
        },
      },
      // Theme-specific fonts
      fontFamily: {
        detective: ['Courier Prime', 'monospace'],
        terminal: ['Cascadia Code', 'monospace'],
      },
    },
  },
  plugins: [
    require('tailwind-scrollbar'),
  ],
}
```

### 6. Theme Toggle Component (Desktop Only)

- Created a theme selector component for desktop only:

```typescript
// src/app/components/ThemeToggle.tsx
'use client';

import { useState, useEffect } from 'react';
import { useTheme } from '../context/ThemeContext';

export default function ThemeToggle() {
  const { theme, setTheme, isDesktop } = useTheme();
  const [isOpen, setIsOpen] = useState(false);
  const [mounted, setMounted] = useState(false);
  
  // Only render component after client-side hydration
  useEffect(() => {
    setMounted(true);
  }, []);
  
  // Don't render anything during SSR or if on mobile
  if (!mounted || !isDesktop) return null;
  
  return (
    <div className="fixed top-5 right-5 z-50">
      <button 
        onClick={() => setIsOpen(!isOpen)}
        className={`p-2 rounded-full transition-colors duration-300 ${
          theme === 'standard' 
            ? 'bg-gray-800 text-white hover:bg-gray-700' 
            : theme === 'detective'
              ? 'bg-[#343434] text-[#ffd700] border border-[#ffd700] hover:bg-[#454545]'
              : 'bg-[#1a1a1a] text-[#00ff00] border border-[#00ff00] hover:bg-[#2a2a2a]'
        }`}
      >
        {theme === 'standard' 
          ? 'Experience' 
          : theme === 'detective'
            ? 'Case Files'
            : 'Terminal'
        }
      </button>
      
      {isOpen && (
        <div className="absolute top-12 right-0 bg-white dark:bg-gray-800 rounded-md shadow-lg overflow-hidden">
          <button 
            onClick={() => { setTheme('standard'); setIsOpen(false); }}
            className="block w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700"
          >
            Standard
          </button>
          <button 
            onClick={() => { setTheme('detective'); setIsOpen(false); }}
            className="block w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700"
          >
            Detective
          </button>
          <button 
            onClick={() => { setTheme('terminal'); setIsOpen(false); }}
            className="block w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700"
          >
            Terminal
          </button>
        </div>
      )}
    </div>
  );
}
```

The ThemeToggle component includes:
- Client-side only rendering to prevent hydration issues
- Desktop-only visibility based on isDesktop from ThemeContext
- Theme-specific button styling
- Dropdown menu for theme selection
- Smooth transitions for better user experience

## Progressive Implementation Approach

### Phase 1: Core Structure (1-2 weeks)

1. **Set up Theme Context and Screen Detection**
   - Implement ThemeContext and ThemeProvider
   - Add desktop detection logic
   - Add theme toggle component for desktop view
   - Extend Tailwind config with theme variables

2. **Create Directory Structure**
   - Create themed asset directories
   - Set up themed component structure

### Phase 2: Hero Section (1 week)

1. **Implement Themed Hero Components**
   - Create DetectiveHero and TerminalHero components
   - Style and test on desktop
   - Implement theme-specific animations

### Phase 3: Section-by-Section Implementation (3-4 weeks)

1. **Experience Section**
   - Create themed experience timelines
   - Implement interactive elements

2. **Projects Section**
   - Design themed project cards
   - Add theme-specific interactions

3. **About Section**
   - Transform about content into themed narrative
   - Add interactive elements

4. **Contact Section**
   - Redesign contact form for each theme
   - Ensure functionality remains clear

### Phase 4: Refinement and Enhancement (2 weeks)

1. **Add Advanced Interactions**
   - Implement sound effects (with controls)
   - Add animations and transitions
   - Consider interactive easter eggs

2. **Performance Optimization**
   - Implement code splitting and lazy loading
   - Optimize assets for desktop viewing

3. **Testing and Debugging**
   - Cross-browser testing on desktop browsers
   - Fix responsive issues within desktop breakpoints

## Technical Considerations

### Asset Management

- Create themed directory structure in public folder focused on desktop assets:
```
public/
  standard/ (existing assets)
  detective/
    images/
    sounds/
    fonts/
  terminal/
    images/
    sounds/
    fonts/
```

### Performance Benefits of Desktop-Only Approach

- Can use higher-quality assets and more complex animations
- No need to optimize for mobile data connections
- More screen space for immersive details and interactions
- Can take advantage of hover states and desktop-specific interactions

### Accessibility Considerations

- Ensure proper contrast ratios for all themes
- Add option to disable animations for users with motion sensitivity
- Implement keyboard navigation for interactive elements
- Include sound mute controls for audio effects

## Implementation Challenges and Solutions

### Challenge: Theme Persistence

**Solution:** Store theme preference in localStorage but only apply on desktop screens:

```typescript
// Enhanced theme context with persistence
export function ThemeProvider({ children }: { children: ReactNode }) {
  // Initialize from localStorage but only if on desktop
  const [theme, setTheme] = useState<Theme>(() => {
    if (typeof window !== 'undefined') {
      const savedTheme = localStorage.getItem('theme') as Theme;
      const isDesktop = window.innerWidth >= 900;
      return isDesktop && savedTheme ? savedTheme : 'standard';
    }
    return 'standard';
  });
  
  // Update localStorage when theme changes
  useEffect(() => {
    if (typeof window !== 'undefined') {
      localStorage.setItem('theme', theme);
    }
  }, [theme]);
  
  return (
    <ThemeContext.Provider value={{ theme, setTheme }}>
      {children}
    </ThemeContext.Provider>
  );
}
```

### Challenge: Enticing Mobile Users to Desktop

**Solution:** Add subtle previews of the themed experience on mobile to encourage desktop viewing:

```typescript
// Example mobile teaser component
const ThemeTeaser = () => {
  return (
    <div className="mt-8 p-4 border border-gray-700 rounded-md">
      <h3 className="text-xl font-bold mb-2">Unlock Immersive Experiences</h3>
      <p className="text-sm text-gray-400 mb-4">
        Visit this site on desktop to explore my portfolio as a detective case file
        or access a futuristic terminal interface.
      </p>
      <div className="flex gap-4 justify-center">
        <div className="w-16 h-16 bg-detective-primary border border-detective-accent rounded opacity-80"></div>
        <div className="w-16 h-16 bg-terminal-primary border border-terminal-accent rounded opacity-80"></div>
      </div>
    </div>
  );
};
```

## Conclusion

By implementing the storyline mode exclusively for desktop, we can:

1. Focus development resources on creating a truly immersive experience
2. Take advantage of desktop-specific capabilities like hover effects and larger screens
3. Maintain the clean, optimized mobile experience without compromise
4. Create a compelling reason for users to view the portfolio on desktop

The implementation leverages the existing NextJS component structure and responsive approach, simply extending it with themed variants for desktop viewing. This approach allows for a high-quality themed experience where it makes most sense, while maintaining a consistent mobile experience. 